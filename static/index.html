<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- <meta name="csrf-token" content="{{ csrf_token() }}"> -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/trix/1.3.1/trix.css"
      integrity="sha512-CWdvnJD7uGtuypLLe5rLU3eUAkbzBR3Bm1SFPEaRfvXXI2v2H5Y0057EMTzNuGGRIznt8+128QIDQ8RqmHbAdg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      
    </style>
  </head>
  <body>
    <button onclick="get_data('/see-file')">get files</button>
    <ul id="files"></ul>
    <p id="output"></p>
    <p>
      <label for="fn">fn</label>
      <input id="fn" type="text" name="fn" /> <br />
      <input id="x" type="text" name="content" value="" />
      <trix-editor input="x" class="trix-content"></trix-editor>
    </p>
    <button id="my_submit">Save</button>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/trix/1.3.1/trix.js"
      integrity="sha512-/1nVu72YEESEbcmhE/EvjH/RxTg62EKvYWLG3NdeZibTCuEtW5M4z3aypcvsoZw03FAopi94y04GhuqRU9p+CQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script>
      let element = document.querySelector("trix-editor");
      let output = document.querySelector("#output");
      let files = document.querySelector("#files");
      let fn = document.querySelector("#fn");
      function uploadUrl(sendObj, end_point) {
        fetch("http://127.0.0.1:5000" + end_point, {
          body: JSON.stringify(sendObj),
          headers: {
            "Content-Type": "application/json",
          },
          method: "post",
        })
          .then((response) => response.json())
          .then((data) => {
            output.innerHTML = JSON.stringify(data);
          })
          .catch((err) => {
            output.innerHTML = JSON.stringify(err);
          });
      }

      function get_data(end_point) {
        fetch("http://127.0.0.1:5000" + end_point, {
          method: "get",
        })
          .then((response) => response.json())
          .then((data) => {
            let arr = [];
            for (let x in data["files"]) {
              arr.push(
                `<li><button onclick="myFun('${data["files"][x]}')">${data["files"][x]}</button></li>`
              );
            }
            files.innerHTML = arr.join("");
          })
          .catch((err) => {
            console.log(err);
            output.innerHTML = JSON.stringify(err);
          });
      }

      function get_content(end_point) {
        fetch("http://127.0.0.1:5000" + end_point, {
          method: "get",
        })
          .then((response) => response.json())
          .then((data) => {
            fn.value = end_point.split('/')[2]
            const editorTextLength = element.editor.getDocument().toString().length;
            element.editor.setSelectedRange([0, editorTextLength]);
            element.editor.insertHTML(data["data"]); // is a Trix.Editor instance

          })
          .catch((err) => {
            console.log(err);
            output.innerHTML = JSON.stringify(err);
          });
      }

      let xmlBtn = document.querySelector("#my_submit");
      xmlBtn.addEventListener("click", function () {
        let sendObj = {
          fn: document.querySelector("#fn").value,
          data: document.querySelector("#x").value,
        };
        uploadUrl(sendObj, "/save");
      });

      function myFun(path) {
        get_content("/view/" + path);
      }
    </script>
  </body>
</html>
